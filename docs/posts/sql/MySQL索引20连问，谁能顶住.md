
## 前言

过完这个节，就要进入金银季，准备了 18 道 MySQL 索引题，一定用得上。


- 作者： 
- 感谢每一个支持： [github](https://github.com/Rodert/JavaPub)


### 索引是什么

[]()

- 索引是一种数据结构，用来帮助提升查询和检索数据速度。可以理解为一本书的目录，帮助定位数据位置。
- 索引是一个文件，它要占用物理空间。



### MySQL索引有哪些类型

**数据结构维度**

- B+tree 索引： B+树是最常用的索引类型，所有数据都会存储在叶子节点上，时间复杂度是 `O(logn)` ，擅长**范围查询**。
- Hash 索引： 哈希索引就是采用哈希算法，将键值换算成新的哈希值，映射到对应槽位，然后存储到哈希表中，**擅长做对等比较（=，in）**。
- Full-text 索引： 全文索引是一种建立倒排索引，实现信息检索。在 MySQL 不同版本中支持程度不同。
- `R-Tree` 索引： 属于地理空间数据类型查询，通常使用较少。


**物理存储维度**

簇 `cù`

- 聚簇索引： `InnoDB 引擎` 要求必须有聚簇索引，也就是在主键字段建立聚簇索引。

- 非聚簇索引： 非聚簇索引就是以非主键创建的索引，在叶子节点存储的是表主键和索引列。 `InnoDB 引擎`


**逻辑维度**

- 主键索引： 主键索引是一种特殊的唯一索引，不允许值重复或者值为空。

- 普通索引： 普通索引是 MySQL 中最基本的索引类型，允许在定义索引的列中插入重复值和空值。

- 联合索引： 联合索引指多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用。使用联合索引时遵循最左前缀集合。

- 唯一索引： 唯一索引列的值必须唯一，允许有空值。

- 空间索引： 空间索引是一种针对空间数据类型（如点、线、多边形等）建立的特殊索引，用于加速地理空间数据的查询和检索操作。



### 主键索引和唯一索引有什么区别

- 数量限制： 唯一索引有多个，但是主键索引一张表只能有一个。
- 本质区别： 被唯一索引约束的健可以为空，主键索引不可以。
- 外键引用： 主键可以被其他表作为外键，从而建立表之间的关系。而唯一索引则不能被其他表用作外键。




### 什么是聚簇索引和非聚簇索引？它们在InnoDB存储引擎中是如何工作的？

**聚簇索引**是将表的数据按照索引顺序存储在磁盘上，聚簇索引的叶子节点直接存储了实际的数据行，而不是指向数据的指针。所以在查询的时候减少了磁盘的随机读取，无需进行多次磁盘I/O效率很高。

**非聚簇索引**是一种基于指针的索引，有时也叫它二级索引。非聚簇索引不直接存储实际的数据，seelec 语句在执行查询时，会先根据二级索引定位到数据所在的磁盘位置，然后再进行一次磁盘I/O操作，读取实际的数据行。



### 复合索引和单列索引有何区别？

- 顾名思义，单列索引就是在一个列上创建的索引，复合索引就是多个列上创建的索引。

- 当只涉及到一个字段查询，单列是非常快速的。当涉及到多个字段查询，WHERE 子句引用了符合索引的所有列或者前导列时，查询速度会非常快。

- 在复合索引中，列的顺序非常重要。MySQL会按照索引中列的顺序从左到右进行匹配。例如，对于复合索引(a, b, c)，它可以支持a、a,b和a,b,c三种组合的查询，但不支持b,c进行查询。因此，在创建复合索引时，应把最常被访问和选择性较高的列放在前面。

当然具体如何选择需要看查询需求、数据分布和性能要求。如果你有开发需要欢迎在 JavaPub 下留言讨论。

### Hash 索引和 B+ 树索引区别是什么？如何选择？

**哈希索引：**

- **工作原理**：通过哈希算法将被索引的列的值存储到一个固定长度的桶（Bucket）。使得在查询特定值的时候非常高效，因为可以直接计算出存储位置，快速定位到数据。
- **查询效率**：在等值查询下，哈希查询效率极高，可以在常数时间复杂度内定位到目标数据。但是范围查询和排序操作时，哈希索引的效率较低，因为哈希算法会导致数据随机分布，无法保持原有的顺序。
- **磁盘存储**：hash 索引的存储是随机的，可能导致磁盘的随机访问，从而降低磁盘的利用效率和查询效率。
- **插入和删除操作**：Hash 索引在插入和删除操作方面相对简单，只需要通过哈希函数确定存储位置即可。

[B+树白话详解_下载]()

**B+树索引**

- **工作原理**：B+树索引使用平衡树，将索引健的值按照顺序保存在树节点中，根据键值的大小关系，并通过节点之间的指针进行查找，快速定位存储了数据的叶子节点。
- **查询效率**：B+树擅长范围查询和排序操作，因为他是按照顺序存储数据，可以高效的支持范围查询和排序操作。
- **磁盘存储**：B+树索引的节点是有序存储的，有利于磁盘的顺序访问，从而减少磁盘的IO次数，提高查询效率。
- **插入和删除操作**：B+树在索引删除和插入操作时，需要维护树的平衡，可能进行节点的拆分和合并，相对哈希索引来说操作更复杂。


所以在选择上：

1. **查询维度**：如果查询主要是等值查询，且对性能要求较高，Hash 索引可能是一个好的选择。然而，如果查询涉及到范围查询、排序操作或模糊查询，B+ 树索引则更为合适。
2. **数据维度**：如果索引列具有大量重复值，Hash索引的效率可能会下降，因为哈希碰撞会导致性能下降。在这种情况下，B+ 树索引可能更为稳定。
3. **磁盘存储和I/O维度**：由于 Hash 索引可能导致磁盘的随机访问，如果磁盘 IO 是性能瓶颈，那么 B+ 树索引可能更适合，因为它更有利于磁盘的顺序访问。

从这三个维度可以很好的应用在你的开发工作中，如果是小数据量的 web 网站查询、直接用 B+ 树就可以了。对于数据量的大小评估，后面单开一篇讲解。


### 索引是否越多越好？为什么？

不是。索引是建立在原数据上的数据结构，所以不论在查询还是更新维护、一定会带来开销。索引并非银弹，正确使用才能发挥奇效。

比如一本书有 100 页，我构建了 50 页的目录，你觉查询起来还会方便吗？

- 数据量小的表不需要建立索引，建立索引反而会增加额外开销。
- 数据变更后索引也需要更新，更多的索引意味着更多的维护成本。
- 索引是放在磁盘的，更能的索引也意味着更多的存储空间。
- 数据重复且分布平均的字短没必要建立索引（比如：性别）




### 索引什么时候会失效？



### 哪些情况下适合建立索引？



### 为什么要用 B+ 树，而不用二叉树？



### 什么是回表？如何减少回表？



### 能否解释什么是位图索引，以及它在MySQL中的使用场景？



### 如何查看MySQL表中已有的索引？



### MySQL中的索引是如何工作的？



### 如何在MySQL中创建全文索引，并说明全文索引的使用场景？



### 在设计数据库索引时，为什么不建议对经常更新的字段创建索引？



### 当表中的数据量非常大时，如何有效地维护和管理索引，以确保查询性能？



### 假设你有一个包含大量数据的表，并且经常需要根据某个字段进行排序。你应如何优化这个字段的索引以提高排序操作的性能？


当你尝试为一个已经存在大量数据的表添加索引时，可能会遇到什么问题？如何解决这些问题？

### 18. 如何优化索引

当你遇到查询性能问题时，如何分析和优化索引的使用？

开放性问题


### 请谈谈你对MySQL索引碎片化的理解，并说明如何检测和修复索引碎片化。


https://juejin.cn/post/7193682380077400122